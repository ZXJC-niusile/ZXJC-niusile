name: Update Year Progress

on:
  schedule:
    - cron: "0 0 * * *" # æ¯å¤©åˆå¤œè¿è¡Œ
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è¿è¡Œ

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - uses: actions/checkout@v3

      - name: Generate Progress SVG
        run: |
          python3 -c '
          import datetime
          
          # 1. è®¡ç®—æ—¶é—´
          now = datetime.datetime.now()
          start_of_year = datetime.datetime(now.year, 1, 1)
          end_of_year = datetime.datetime(now.year + 1, 1, 1)
          total_seconds = (end_of_year - start_of_year).total_seconds()
          elapsed_seconds = (now - start_of_year).total_seconds()
          progress = (elapsed_seconds / total_seconds) * 100
          days_left = (end_of_year - now).days
          
          # 2. ğŸ¨ æ ·å¼é…ç½® (è“è‰²èƒ¶å›Šé£æ ¼)
          bar_color = "#58a6ff"   # è¿›åº¦æ¡é¢œè‰²: è“è‰²
          bg_color = "#24292e"    # èƒŒæ™¯é¢œè‰²: æ·±ç° (GitHub ç»å…¸é»‘)
          text_color = "#ffffff"  # æ–‡å­—é¢œè‰²: çº¯ç™½
          
          # 3. ç»˜åˆ¶ SVG (Compact Style - æ–‡å­—åœ¨æ¡å†…)
          width = 800
          height = 40  # ğŸŒŸ å…³é”®ä¿®æ”¹ï¼šé«˜åº¦æ”¹å°ï¼Œå˜æˆä¸€æ¡
          radius = 8   # åœ†è§’å¤§å°
          
          fill_width = (width * progress) / 100
          
          # ä½¿ç”¨ clipPath ä¿è¯è“è‰²è¿›åº¦æ¡å·¦è¾¹æ˜¯åœ†è§’ï¼Œå³è¾¹æ˜¯ç›´åˆ‡ï¼ˆé™¤éæ»¡æ ¼ï¼‰
          svg_content = f"""<svg width="{width}" height="{height}" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <clipPath id="round-corner">
                    <rect width="{width}" height="{height}" rx="{radius}" ry="{radius}"/>
                </clipPath>
            </defs>
            
            <rect width="{width}" height="{height}" fill="{bg_color}" clip-path="url(#round-corner)"/>
            
            <rect width="{fill_width}" height="{height}" fill="{bar_color}" clip-path="url(#round-corner)"/>
            
            <text x="50%" y="26" font-family="Verdana, Geneva, sans-serif" font-size="16" fill="{text_color}" text-anchor="middle" font-weight="bold">
              {now.year} Progress: {progress:.1f}% ({days_left} Days Left)
            </text>
          </svg>"""
          
          # 4. ä¿å­˜æ–‡ä»¶
          with open("progress.svg", "w") as f:
              f.write(svg_content)
          '

      - name: Commit & Push
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add progress.svg
          git diff --quiet && git diff --staged --quiet || (git commit -m "update progress bar to compact style" && git push)
